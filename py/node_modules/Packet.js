"use strict";

const Socket = require("net").Socket;

Socket.prototype.sendPacket = function(msgId, usrId, msgData){
	this.write(exports.CreatePacket(msgId, usrId, msgData));
};

exports.CreateNamePacket = function(name){
	var packet = new Buffer(2 + name.length);
	packet.writeUInt16BE(packet.length);
	packet.write(name, 2);
	return packet;
};

exports.CreatePacket = function(msgId, usrId, msgData){
	var packet;
	if(msgData == null){
		packet = new Buffer(6);
	}else if(Buffer.isBuffer(msgData)){
		packet = Buffer.concat([new Buffer(6), msgData], 6 + msgData.length);
	}else{
		msgData = JSON.stringify(msgData);
		packet = new Buffer(6 + Buffer.byteLength(msgData));
		packet.write(msgData, 6);
	}
	packet.writeUInt16BE(packet.length);
	packet.writeUInt16BE(msgId, 2);
	packet.writeUInt16BE(usrId, 4);
	return packet;
};