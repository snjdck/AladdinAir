"use strict";

const Packet = require("./Packet");

module.exports = class {
	constructor(){
		this.handlerDict = [];
	}

	addHandler(msgId, handler){
		this.handlerDict[msgId] = handler;
	}

	dispatch(packet, socket){
		var msgId = Packet.ReadMsgId(packet);
		var usrId = Packet.ReadUsrId(packet);
		var handler = this.handlerDict[msgId];
		if(null == handler){
			console.error("handler not set:" + msgId);
			return;
		}
		var msgData = Packet.ReadMsgData(packet);
		try{
			handler.call(socket, usrId, msgData);
		}catch(error){
			console.error(error);
		}
	}
}