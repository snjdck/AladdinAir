"use strict";

module.exports = class {
	constructor(){
		this.handlerDict = [];
	}

	addHandler(msgId, handler){
		this.handlerDict[msgId] = handler;
	}

	dispatch(packet, socket){
		var msgId = packet.readUInt16BE(2);
		var usrId = packet.readUInt16BE(4);
		var handler = this.handlerDict[msgId];
		if(null == handler){
			console.error("handler not set:" + msgId);
			return;
		}
		var msgData = null;
		if(packet.length > 6){
			var json = packet.toString("utf8", 6);
			try{
				msgData = JSON.parse(json);
			}catch(error){
				console.error("json parse error:" + json);
			}
		}
		try{
			handler.call(socket, usrId, msgData);
		}catch(error){
			console.error(error);
		}
	}
}