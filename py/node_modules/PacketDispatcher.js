"use strict";

const Packet = require("./Packet");

module.exports = class {
	constructor(){
		this.handlerDict = [];
	}

	addHandler(msgId, handler){
		this.handlerDict[msgId] = handler;
	}

	dispatch(packet, socket){
		var msgId	= Packet.ReadMsgId(packet);
		var handler = this.handlerDict[msgId];
		if(null == handler){
			console.error("handler not set:" + msgId);
			return;
		}
		var usrId	= Packet.ReadUsrId(packet);
		var svrId	= Packet.ReadSvrId(packet);
		var data	= Packet.ReadMsgData(packet);
		try{
			handler.call(socket, {msgId, usrId, svrId, data, raw:packet});
		}catch(error){
			console.error(error);
		}
	}
}